name: Monthly Garmin Sync

on:
  schedule:
    # "cron" defines the schedule.
    # '0 8 1 * *' means: At minute 0, hour 8, on day 1 of the month.
    - cron: '0 8 1 * *'
  workflow_dispatch: # This allows you to click a "Run Now" button manually if needed

jobs:
  monthly_sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run Monthly Sync Script
      env:
        # These pull the passwords/IDs from your GitHub Repository Settings > Secrets
        USER1_GARMIN_EMAIL: ${{ secrets.GARMIN_EMAIL }}
        USER1_GARMIN_PASSWORD: ${{ secrets.GARMIN_PASSWORD }}
        GOOGLE_SHEETS_CREDENTIALS: ${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}
        USER1_MONTHLY_SHEET_ID: ${{ secrets.MONTHLY_SHEET_ID }}
        
      run: |
        # This executes your python script with the monthly command
        python -m src.main cli-monthly-sync --profile USER1
